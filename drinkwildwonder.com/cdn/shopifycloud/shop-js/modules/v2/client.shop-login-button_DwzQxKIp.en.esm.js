import{i as e,k as t,I as o,_ as n,u as i,R as s,p as r,t as a,g as l,h as c,r as u,A as d,T as p,J as h,y as g,K as m,q as f,D as S,L as _,M as v,n as I,N as w,b as C,O as y,Q as T,U as b,V as x}from"./chunk.common_9bWy_6S0.esm.js";import{A as O}from"./chunk.modal_ByBoMpEK.esm.js";const W=e=>{null==e||e.close()},N=(o,n)=>{const i=((o,n)=>{const i=void 0===e.screenLeft?e.screenX:e.screenLeft,s=void 0===e.screenTop?e.screenY:e.screenTop;let r,a;r=e.innerWidth?e.innerWidth:t.documentElement.clientWidth?t.documentElement.clientWidth:screen.width,a=e.innerHeight?e.innerHeight:t.documentElement.clientHeight?t.documentElement.clientHeight:screen.height;const l=Math.max(1,r/e.screen.availWidth);return{height:n/l,left:(r-o)/2/l+i,top:(a-n)/2/l+s,width:o/l}})(365,554),s=e.open(o,"SignInWithShop",`popup,width=${i.width},height=${i.height},top=${i.top},left=${i.left}`);return e.addEventListener("beforeunload",(()=>W(s)),{once:!0}),e.addEventListener("unload",(()=>W(s)),{once:!0}),e.addEventListener("pagehide",(()=>W(s)),{once:!0}),e.addEventListener("message",n),s},k={loginWithShop:"default",loginWithShopSelfServe:"self_serve_customer_accounts",loginWithShopClassicCustomerAccounts:"classic_customer_accounts",loginWithShopPrequal:"shop_pay_installments_prequal",loginWithShopPaymentRequest:"payment_request",loginWithShopCheckoutExtension:"default",loginWithShopCheckoutModal:"checkout_modal",loginWithShopShopWeb:"",shopCashOffers:"shop_cash_offers"};function L({analyticsContext:e="loginWithShop",checkoutToken:t,checkoutVersion:o,flowVersion:n,shopId:i,source:s}){return{analyticsContext:e,checkoutVersion:o,checkoutToken:t,flow:k[e],flowVersion:n,shopId:i,source:s}}const P=["loginWithShop"],E=o=>{var{action:s,activatorId:W,analyticsContext:k="loginWithShop",anchorTo:L,autoOpen:E,email:H,emailInputSelector:M,firstname:B,hideButton:U,lastname:A,persistAfterSignIn:V=!0,proxy:$=!1,uxMode:q="iframe",version:R}=o,j=n(o,["action","activatorId","analyticsContext","anchorTo","autoOpen","email","emailInputSelector","firstname","hideButton","lastname","persistAfterSignIn","proxy","uxMode","version"]);const{notify:G}=r(),{trackPageImpression:K,trackUserAction:D}=a(),{translate:F}=l(),[z,J]=c(!0),Q=u(),X=d(W?t.getElementById(W):null),Y=d(null),Z=d(null),ee=d(null),[te,oe]=c(),ne=p((()=>"windoid"===q),[q]),{getSubmittedEmail:ie,updateEmailToPost:se,updateNamesToPost:re}=h({autoOpen:E,email:H,emailInputSelector:M,iframeRef:Z});g((()=>{re(B,A)}),[B,A,re]);const ae=p((()=>{const e=e=>S(void 0,[e],void 0,(function*({detail:e}){oe(void 0);const t=e.email;yield se(t)}));return{requestShow:e,start:e}}),[se]);m(ae),g((()=>{s&&("follow"===s?console.warn("[Sign in with Shop] The action prop is deprecated, please use <shop-follow-button> instead."):console.warn(`[Sign in with Shop] Received deprecated attribute: action, "${s}"`))}),[s,G]),g((()=>{U||K({page:"SIGN_IN_WITH_SHOP_BUTTON"})}),[U,K]);const le=f((t=>S(void 0,[t],void 0,(function*({email:t,loggedIn:o,shouldFinalizeLogin:n,givenName:i,userInteracted:s,redirectUri:r}){let a;V||J(!1),s||(a=F("shopLoginButton.toast.action"));let l=F("shopLoginButton.toast.default");i&&(l=F("shopLoginButton.toast.user",{user:i}));const c={actionText:a,subText:t,text:l};P.includes(k)?y(c):ne&&T(b,c),o&&n&&(yield x(j.storefrontOrigin,G)),r&&(e.location.href=r)}))),[k,ne,G,V,j.storefrontOrigin,F]),ce="loginWithShopPrequal"===k?{disableSignUp:!1,flow:"prequal",flowVersion:"unspecified",hideCopy:!1,isCompactLayout:!1,proxy:!0}:{},ue=p((()=>(void 0!==R&&console.warn(`[Sign in with Shop] Received deprecated attribute: version, "${R}"`),$||"2"===R)),[$,R]),de=_(Object.assign(Object.assign(Object.assign({analyticsContext:k,error:te},j),{proxy:ue,uxMode:q}),ce)),pe=f((e=>{ee.current=N(e,(e=>{var t;"completed"===e.data.type&&(le(e.data),Q("completed",e.data,!0),null===(t=ee.current)||void 0===t||t.close())}))}),[le,Q]);const he=f((()=>{D({userAction:"SIGN_IN_WITH_SHOP_BUTTON_CLICK"}),ne&&pe(de)}),[D,ne,de,pe]),ge=v(he,150,!0),me=f((()=>{var e;D({userAction:"SIGN_IN_WITH_SHOP_PROMPT_CHANGE_CLICK"}),null===(e=null==Z?void 0:Z.current)||void 0===e||e.close({dismissMethod:"prompt_change",reason:"user_prompt_change_clicked"})}),[D]),fe=f((()=>{var e;D({userAction:"SIGN_IN_WITH_SHOP_PROMPT_CONTINUE_CLICK"}),null===(e=null==Z?void 0:Z.current)||void 0===e||e.close({dismissMethod:"windoid_continue",reason:"user_prompt_continue_clicked"});const t=ie(),o=t?`${de}&login_start=${encodeURIComponent(t)}`:de;pe(`${o}&source=prompt`)}),[ie,pe,de,D]),Se=U||X.current||!z?null:i(w,{onClick:ge,ref:Y,className:"m-auto",children:i("span",{className:"cursor-pointer whitespace-nowrap px-11 py-4 font-sans text-button-large text-white",children:F("shopLoginButton.continue",{shop:i(I,{className:"relative inline-block h-4 w-auto"})})})}),_e=X.current?X:Y,ve=ne?void 0:_e,Ie=ne?`${de}&ux_role=prompt`:de,we=ne?F("shopLoginButton.title",{defaultValue:""}):"";return i(C,{children:[Se,i(O,{activator:ve,anchorTo:L,autoOpen:E&&!ee.current,modalHeaderTitle:we,onComplete:le,onError:function({code:e,email:t,message:o}){var n;Q("error",{code:e,email:t,message:o}),"retriable_server_error"===e&&(te===e&&(null===(n=Z.current)||void 0===n||n.reload()),oe(e))},onPromptChange:me,onPromptContinue:fe,proxy:ue,ref:Z,src:Ie,variant:"default"})]})},H=e=>S(void 0,void 0,void 0,(function*(){return{shopLoginButton:{title:"Sign in with Shop",continue:"Sign in with {shop}",toast:{default:"Signed in with Shop",user:"Signed in as {user}",action:"Switch"}}}}));o((e=>{var{element:t}=e,o=n(e,["element"]);return i(s,{element:t,featureName:"ShopLoginButton",getFeatureDictionary:H,monorailProps:L(o),children:i(E,Object.assign({},o))})}),{methods:["requestShow","start","showToast"],name:"shop-login-button",props:{action:"string",activatorId:"string",analyticsContext:"string",anchorTo:"string",apiKey:"string",autoOpen:"boolean",avoidPayAltDomain:"boolean",checkoutVersion:"string",clientId:"string",codeChallenge:"string",codeChallengeMethod:"string",consentChallenge:"string",disableSignUp:"boolean",email:"string",emailInputSelector:"string",firstname:"string",flow:"string",flowVersion:"string",hideButton:"boolean",keepModalOpen:"boolean",lastname:"string",persistAfterSignIn:"boolean",popUpFeatures:"string",popUpName:"string",proxy:"boolean",redirectType:"string",redirectUri:"string",requireVerification:"boolean",responseMode:"string",responseType:"string",scope:"string",source:"string",state:"string",uxMode:"string",version:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-login-button_DwzQxKIp.en.esm.js.map
