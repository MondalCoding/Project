import"./client.shop-login-button_DwzQxKIp.en.esm.js";import{D as e,a1 as n,Y as t,i as o,a4 as i,ag as a,E as s,k as r,ab as c,ac as l,ad as u,ah as d,ai as m,aj as p,ae as f,a7 as g,a8 as h,ak as _,a9 as v}from"./chunk.common_9bWy_6S0.esm.js";import"./chunk.modal_ByBoMpEK.esm.js";function y(){return e(this,arguments,void 0,(function*(v=!1,y=!1){var w,E;const k=n(),j=new t("initCustomerAccounts"),A={analyticsContext:"loginWithShopClassicCustomerAccounts",analyticsTraceId:k,apiKey:"",flow:"classic_customer_accounts",flowVersion:"sign_in",shopPermanentDomain:null!==(E=null===(w=o.Shopify)||void 0===w?void 0:w.shop)&&void 0!==E?E:""},I=new i({analyticsData:A,notify:j.notify});try{if(a(o.location.pathname).endsWith("/account"))return void function(){e(this,void 0,void 0,(function*(){I.trackPageImpression({page:"CLASSIC_CUSTOMER_ACCOUNTS_ACCOUNT_PAGE"}),yield import("./loader.shop-toast-manager.en.esm.js")}))}();v&&function(){const e=r.querySelector("#customer_login");if(!e)return;c({mediation:"required",analyticsTraceId:k,monorailTracker:I}).then((n=>function(e,n,t,i){if(200!==e.status)return void(null==i||i.notify(new Error("FedCM failed to authenticate")));if(!n)return void(null==i||i.notify(new Error("FedCM failed to find the nearest form to leverage sign in URL")));const a=O(n,t);o.location.assign(a)}(n,e,k,j))).catch((e=>function(e,n){if(e instanceof d||e instanceof m||"IdentityCredentialError"===e.name&&"Error retrieving a token."===e.message||e instanceof DOMException&&"NetworkError"===e.name&&"Error retrieving a token."===e.message)return;n.notify(e)}(e,j)))}(),function({autoOpen:e,windoidMode:n}){const t=new WeakMap;let i=null;const a=l({onFallback:e=>{e.addEventListener("focus",s,{once:!0}),I.produceMonorailEvent({event:{schemaId:"shopify_pay_login_with_shop_sdk_error_events/1.0",payload:Object.assign(Object.assign({},A),{sdkVersion:"1.0.31-beta",errorCode:"fallback_to_focus_event",errorMessage:"Fallback to focus event for classic customer accounts"})}})},onVisible:n=>c({input:n,autoOpen:e})});function s(n){c({input:n.target,autoOpen:e})}function c({input:e,autoOpen:a}){var s;const c=e.form;if(!c)return void j.notify(new Error("Email form missing for classic customer accounts"));t.has(e)&&(j.notify(new Error("Input listener already exists for input")),null===(s=t.get(e))||void 0===s||s.destroy(),t.delete(e)),i||(i=function({autoOpen:e,windoidMode:n}){let t,o=!1;t=r.querySelector("shop-login-button:not([action])"),t||(t=g("shop-login-button"),o=!0);(function({element:e,props:n}){Object.entries(Object.assign(Object.assign({},b),n)).forEach((([n,t])=>{const o=_(n);e.setAttribute(o,String(t))}))})({element:t,props:Object.assign(Object.assign(Object.assign(Object.assign({autoOpen:e,consentChallenge:!0,disableSignUp:!0},o?{hideButton:!0}:{}),{proxy:!0}),h()),n&&{uxMode:"windoid",responseType:"code"})}),o&&r.body.appendChild(t);return t}({autoOpen:a,windoidMode:n}),i.addEventListener("completed",(()=>{const e=O(c,C(i));o.location.assign(e)})),i.addEventListener("modalclosed",(()=>{p("signInWithShop:modalDismissed","true")}))),i.getAttribute("defer-modal-on-autofill")&&i.setAttribute("email-input-selector",`#${e.id}`),i.setAttribute("email",e.value),t.set(e,new f(e,(e=>{null==i||i.setAttribute("email",e)})));const l=r.createElement("input");l.type="hidden",l.name="login_with_shop[analytics_trace_id]",l.value=C(i),c.appendChild(l)}u({onElementFound:e=>a.observe(e),selector:'form[data-login-with-shop-sign-in] input[type="email"],form[data-login-with-shop-sign-in] input[name="customer[email]"'})}({autoOpen:!v,windoidMode:y})}catch(e){e instanceof Error&&j.notify(e),e instanceof s&&"InitCustomerAccountsError"===e.name&&I.produceMonorailEvent({event:{payload:Object.assign(Object.assign({},A),{analyticsTraceId:e.analyticsTraceId||k,errorCode:e.code,errorMessage:e.message,sdkVersion:"1.0.31-beta"}),schemaId:"shopify_pay_login_with_shop_sdk_error_events/1.0"}})}}))}const b={analyticsContext:"loginWithShopClassicCustomerAccounts",clientId:"",flowVersion:"sign_in"};function O(e,n){var t,i;const a=null===(t=e.elements.namedItem("checkout_url"))||void 0===t?void 0:t.value,s=null===(i=e.elements.namedItem("return_url"))||void 0===i?void 0:i.value,r=new URLSearchParams(Object.assign(Object.assign({analytics_trace_id:n},a&&{checkout_url:a}),s&&{return_url:s}));return`${o.location.origin}/account/redirect?${r.toString()}`}function C(e){return(null==e?void 0:e.getAttribute("data-instance-id"))||n()}v("initCustomerAccounts",y);
//# sourceMappingURL=client.init-customer-accounts_Bkt0KjOL.en.esm.js.map
