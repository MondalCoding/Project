"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[930],{73501:function(e,t,n){var r=n(42982),o=n(15861),i=n(87757),a=n.n(i),s=n(11752),c=n(5732),l=n(34406),u=(0,s.default)().publicRuntimeConfig;function p(){return(p=(0,o.Z)(a().mark((function e(t){var n,r,o,i,s,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.input,o=t.storeUrl,i=t.countryCode,e.prev=1,e.next=4,fetch("".concat(u.apiUrl,"/otp/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:n,input:r,storeUrl:o,countryCode:i})});case 4:return s=e.sent,e.next=7,s.json();case 7:if(c=e.sent,!s.ok){e.next=12;break}return e.abrupt("return",c);case 12:throw new Error(c.message||"An error occurred. Try again");case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(1),new Error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function d(){return(d=(0,o.Z)(a().mark((function e(t){var n,o,i,s,l,p,d,h,f,y,x,m;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.iv,o=t.content,i=t.otp,s=t.type,l=t.input,p=t.countryCode,d=t.storeUrl,e.prev=1,e.next=4,fetch("".concat(u.apiUrl,"/otp/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({check:{type:s,input:l,countryCode:p},verification_key:{iv:n,content:o},otp:i})});case 4:return h=e.sent,e.next=7,h.json();case 7:return f=e.sent,e.next=10,fetch("".concat(u.apiUrl,"/shoppers/trackers"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(f.access_token)},body:JSON.stringify({storeUrl:d,input:l,type:s})});case 10:return y=e.sent,e.next=13,y.json();case 13:if(x=e.sent,!h.ok){e.next=20;break}return m={name:f.shopper.email,$email:f.shopper.email,prive_id:f.shopper.id},y.ok&&(c.ZP.register({login_type:"OTP",store_url:d,store_id:x.merchantid}),c.ZP.identify(f.shopper.email),c.ZP.people.set(m),c.ZP.track.apply(c.ZP,(0,r.Z)((0,c.cJ)()))),e.abrupt("return",f);case 20:throw new Error(f.message||"An error occurred. Try again");case 21:e.next=26;break;case 23:throw e.prev=23,e.t0=e.catch(1),new Error(e.t0);case 26:case"end":return e.stop()}}),e,null,[[1,23]])})))).apply(this,arguments)}function h(){return(h=(0,o.Z)(a().mark((function e(t){var n,r,o,i,s,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.customerEmail,r=t.storeUrl,e.prev=1,e.next=4,fetch("authtoken?customerEmail=".concat(encodeURIComponent(n),"&storeUrl=").concat(r),{method:"Get",headers:{"Content-Type":"text/html"}});case 4:return i=e.sent,e.next=7,i.text();case 7:if(s=e.sent,c=(new DOMParser).parseFromString(s,"text/html"),l=null===(o=c.getElementById("tokenRef"))||void 0===o?void 0:o.innerText,!i.ok){e.next=14;break}return e.abrupt("return",l);case 14:throw new Error("An error occurred. Try again");case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(1),new Error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function f(){return(f=(0,o.Z)(a().mark((function e(t){var n,r,o,i,s,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.shop2appToken,r=t.storeUrl,e.prev=1,e.next=4,fetch("authtoken?shop2appToken=".concat(encodeURIComponent(n),"&storeUrl=").concat(r),{method:"Get",headers:{"Content-Type":"text/html"}});case 4:return i=e.sent,e.next=7,i.text();case 7:if(s=e.sent,c=(new DOMParser).parseFromString(s,"text/html"),l=null===(o=c.getElementById("tokenRef"))||void 0===o?void 0:o.innerText,!i.ok){e.next=14;break}return e.abrupt("return",l);case 14:throw new Error("An error occurred. Try again");case 15:e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(1),new Error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function y(){return(y=(0,o.Z)(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(u.apiUrl,"/auth/verifyToken?hmac=")+t,{method:"GET",headers:{"Content-Type":"application/json","X-Prive-Key":l.env.PRIVE_API_SECRET||""}}).then((function(e){return e.ok?{ok:!0,response:e}:(console.error("".concat(e.status,": ").concat(e.statusText)),{ok:!1,response:e})})).then((function(e){return e.ok})).catch((function(e){return console.error("Unknown error",e),!1}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.Z={generateOtp:function(e){return p.apply(this,arguments)},verifyOtp:function(e){return d.apply(this,arguments)},getAccessTokenIfAvailable:function(e){return h.apply(this,arguments)},isValidShopifyRequest:function(e){return y.apply(this,arguments)},getAccessTokenForShop2App:function(e){return f.apply(this,arguments)}}},26522:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(4942),o=n(44925),i=n(33927),a=n(68434),s=(n(2784),n(52322)),c=["title","subtitle","titleStyles","subTitleStyles"];function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=function(e){var t=e.title,n=e.subtitle,r=e.titleStyles,l=e.subTitleStyles,p=(0,o.Z)(e,c);return(0,s.jsxs)(i.Z,u(u({},p),{},{children:[(0,s.jsx)(a.Z,{variant:"h5",fontSize:"24px",fontWeight:"500",lineHeight:"30px",dangerouslySetInnerHTML:{__html:t},sx:u({},r)}),n&&(0,s.jsx)(a.Z,{variant:"body2",fontSize:{xs:"12px",sm:"16px"},lineHeight:"18px",color:"#747B86",dangerouslySetInnerHTML:{__html:n},sx:u({},l)})]}))}},50003:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(33927),o=n(52529),i=n(68434),a=n(2784),s=n(63134),c=n(52322),l=function(e){var t,n,l=e.primaryText,u=e.linkText,p=e.onAction,d=e.onLinkAction,h=e.isLoading,f=e.storeUrl,y=(0,a.useContext)(s.$j);return(0,c.jsxs)(r.Z,{spacing:3,children:[(0,c.jsx)(o.Z,{disableElevation:!0,variant:"contained",className:"login_button",onClick:p,disabled:h,sx:{borderRadius:(null===y||void 0===y||null===(t=y.loginStyles)||void 0===t||null===(n=t.button)||void 0===n?void 0:n.borderRadius)||{xs:"8px",sm:"20px"},height:"46px",width:{sm:"132px"},boxShadow:{xs:"none",sm:"0px 4px 5px rgba(0, 0, 0, 0.1)"},alignSelf:{sm:"center"}},children:h?"Loading..":l}),(0,c.jsx)(o.Z,{variant:"text",onClick:d,disabled:h,color:"primary",sx:{backgroundColor:"transparent",width:"fit-content",color:null===y||void 0===y?void 0:y.linkColor,alignSelf:"center",marginTop:"8px",fontSize:"1.125em","&:hover":{backgroundColor:"transparent",color:(null===y||void 0===y?void 0:y.linkColor)||"rgb(21, 95, 160)"},textTransform:"none"},children:u}),!["new-aroma360.myshopify.com","hotelcollection.myshopify.com","craig-dev-store-12.myshopify.com"].includes(f||"")&&(0,c.jsxs)(r.Z,{direction:"row",alignSelf:"flex-end",gap:"6px",alignItems:"center",children:[(0,c.jsx)(i.Z,{variant:"body2",lineHeight:"24px",fontWeight:"400",fontStyle:"normal",fontFamily:"Roboto",letterSpacing:"0.01em",color:"rgba(66, 82, 110, 1)",children:"Securely Powered by"}),(0,c.jsx)(i.Z,{variant:"body1",fontWeight:"bold",fontFamily:"Poppins",lineHeight:"18px",color:"#42526E",children:"Prive"})]})]})}},50930:function(e,t,n){n.r(t),n.d(t,{__N_SSP:function(){return A},default:function(){return I}});var r=n(15861),o=n(70885),i=n(30168),a=n(87757),s=n.n(a),c=n(33927),l=n(68434),u=n(11163),p=n(2784),d=n(4942),h=n(48982),f=n(33994),y=n(52322);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,d.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=function(e){var t,n=e.onChange,r=e.InputProps,i=e.storeTheme,a=p.useState(""),s=(0,o.Z)(a,2),u=s[0],d=s[1];return p.useEffect((function(){n(u)}),[u]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(l.Z,{variant:"body2",children:"Email"}),(0,y.jsx)(c.Z,{spacing:1,direction:"row",children:(0,y.jsx)(h.Z,{fullWidth:!0,sx:{fontSize:"24px"},children:(0,y.jsx)(f.Z,{size:"small",variant:"outlined",value:u,onChange:function(e){return d(e.target.value)},placeholder:"john@example.com",InputProps:m({style:m({fontSize:"16px"},null===i||void 0===i||null===(t=i.loginStyles)||void 0===t?void 0:t.inputText)},r)})})})]})},v=n(26522),g=n(50003),j=n(50828);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,d.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){var t,n,r=e.onChange,i=e.InputProps,a=e.storeTheme,s=p.useState(""),u=(0,o.Z)(s,2),d=u[0],x=u[1],m=p.useState(null!==a&&void 0!==a&&a.loginPhoneCountrySelectDefault?a.loginPhoneCountrySelectDefault:""),b=(0,o.Z)(m,2),v=b[0],g=b[1];return p.useEffect((function(){r(d,v)}),[d,v]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(l.Z,{variant:"body2",children:"Mobile Number"}),(0,y.jsxs)(c.Z,{spacing:1,direction:"row",children:[(0,y.jsx)(h.Z,{size:"small",sx:{flex:.35},children:(0,y.jsx)(j.i,{size:"small",variant:"outlined",value:""===v&&null!==a&&void 0!==a&&a.loginPhoneCountrySelectDefault?a.loginPhoneCountrySelectDefault:v,sx:w({height:"40px",borderRadius:"4px"},null===a||void 0===a||null===(t=a.loginStyles)||void 0===t?void 0:t.inputText),onChange:function(e){return g(e.target.value)}})}),(0,y.jsx)(h.Z,{fullWidth:!0,sx:{flex:.65},children:(0,y.jsx)(f.Z,{size:"small",variant:"outlined",value:d,onChange:function(e){return x(e.target.value)},placeholder:"Mobile number*",sx:{height:"40px"},InputProps:w({style:w({fontSize:"16px"},null===a||void 0===a||null===(n=a.loginStyles)||void 0===n?void 0:n.inputText)},i)})})]})]})},S=n(73501);function P(e,t){if(!e||""===e)return!0;switch(t){case"PHONE":return!(r=e)||""===r||/^\d{1,14}$/.test(r);case"EMAIL":return!(n=e)||""===n||/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)}var n,r}var Z,T=n(65992),C=n(38947),E=(0,T.ZP)("div")(Z||(Z=(0,i.Z)(["\n  background-color: ",";\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"])),(function(e){var t=e.storeTheme;return(null===t||void 0===t?void 0:t.bgColor)||"transparent"})),A=!0,I=function(e){var t,n,i,a,d=e.storeTheme,h=e.inputStoreUrl,f=(0,u.useRouter)(),x=(0,p.useContext)(C.Xs).setSession,m=f.query.storeUrl;m=m||h;var j=p.useState("EMAIL"),O=(0,o.Z)(j,2),w=O[0],Z=O[1],T=p.useState(!1),A=(0,o.Z)(T,2),I=A[0],_=A[1],U=p.useState(""),L=(0,o.Z)(U,2),D=L[0],N=L[1],M=p.useState(""),z=(0,o.Z)(M,2),H=z[0],R=z[1],F=p.useState(""),B=(0,o.Z)(F,2),W=B[0],G=B[1],J=["new-aroma360.myshopify.com","hotelcollection.myshopify.com","craig-dev-store-12.myshopify.com"].includes(m),$="https://".concat(m,"/tools/recurring/get-subscription-access");function X(){return(X=(0,r.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R(""),m){e.next=4;break}return R("Cannot perform login. Please refresh the page and try again."),e.abrupt("return");case 4:if(D){e.next=7;break}return R("Please enter your ".concat("EMAIL"===w?"email":"mobile number")),e.abrupt("return");case 7:if(P(D.trim(),w)){e.next=10;break}return R("Invalid input: check your ".concat("EMAIL"===w?"email":"mobile number"," format.")),e.abrupt("return");case 10:if("PHONE"!==w||W){e.next=13;break}return R("Please select your country"),e.abrupt("return");case 13:return _(!0),e.prev=14,e.next=17,S.Z.generateOtp({input:D.trim(),type:w,countryCode:W,storeUrl:m});case 17:return t=e.sent,e.next=20,x({logindata:{iv:t.iv,content:t.content,input:D,type:w,storeUrl:m,countryCode:W}});case 20:e.next=29;break;case 22:if(e.prev=22,e.t0=e.catch(14),_(!1),"Error: Not Found"!==e.t0.message){e.next=28;break}return R("This ".concat("EMAIL"===w?"email":"mobile number"," is not associated with an account. Please try another one.")),e.abrupt("return");case 28:R("Something unexpected occurred with the ".concat("EMAIL"===w?"email":"mobile number"," entered. Please try again."));case 29:case"end":return e.stop()}}),e,null,[[14,22]])})))).apply(this,arguments)}function q(e,t){N(e),"PHONE"===w&&t&&G(t)}return(0,y.jsx)(E,{className:"Homez",children:(0,y.jsxs)(c.Z,{sx:{padding:"24px",width:{xs:"100%",sm:"660px"},height:{xs:"100%",sm:"428px"},backgroundColor:d.bgColor||"white",borderRadius:"10px"},justifyContent:{xs:"flex-start",sm:"space-between",md:"space-between"},children:[(0,y.jsxs)("div",{children:[d&&(null===d||void 0===d?void 0:d.loginTopContent)&&(0,y.jsx)("div",{dangerouslySetInnerHTML:{__html:null===d||void 0===d?void 0:d.loginTopContent}}),(0,y.jsx)(v.Z,{spacing:{xs:"8px",sm:"16px"},marginBottom:"32px",textAlign:"center",title:(null===d||void 0===d||null===(t=d.loginCopy)||void 0===t?void 0:t.title)||"Login to manage subscriptions",subtitle:(null===d||void 0===d||null===(n=d.loginCopy)||void 0===n?void 0:n.subTitle)||"Please enter your ".concat("EMAIL"===w?"email":"mobile number"," to verify your account"),titleStyles:null===d||void 0===d||null===(i=d.loginStyles)||void 0===i?void 0:i.labelTitle,subTitleStyles:null===d||void 0===d||null===(a=d.loginStyles)||void 0===a?void 0:a.labelSubTitle}),(0,y.jsxs)(c.Z,{spacing:1,my:2,paddingX:{sm:8},children:["PHONE"===w?(0,y.jsx)(k,{onChange:q,storeTheme:d}):(0,y.jsx)(b,{onChange:q,storeTheme:d}),H&&(0,y.jsx)(y.Fragment,{children:J&&-1!==H.indexOf("not associated with an account")?(0,y.jsxs)(l.Z,{color:d.errorTextColor||"error",children:["Error. Subscribed before 4/20? "," ",(0,y.jsx)("a",{target:"_parent",href:$,style:{color:"black"},children:"Click here to log in"})]}):(0,y.jsx)(l.Z,{color:d.errorTextColor||"error",children:H})})]})]}),(0,y.jsx)(g.Z,{isLoading:I,onAction:function(){return X.apply(this,arguments)},onLinkAction:function(){Z("PHONE"===w?"EMAIL":"PHONE"),N(""),G(""),R("")},primaryText:"LOGIN",linkText:"Use ".concat("EMAIL"===w?"mobile number":"email"," instead"),storeUrl:m})]})})}}}]);